# Пошаговая инструкция исправления eMMC в Windows

## Шаг 1: Подключить eMMC

1. Вставь eMMC в USB адаптер
2. Подключи к компьютеру
3. Открой Ext2Fsd (Ext2Mgr)
4. Найди диск с eMMC в списке
5. Нажми правой кнопкой → "Change" → выбери букву диска (например, E:)
6. Нажми "OK" - диск должен появиться в проводнике Windows

## Шаг 2: Исправить sysctl.conf (КРИТИЧНО!)

**ВАЖНО:** Это самый важный шаг! Параметры ядра для реального времени - основная причина блокировки загрузки.

### Вариант A: Автоматически (рекомендуется)

1. Скачай файл `fix_sysctl.bat` из репозитория
2. Скопируй файл `/etc/sysctl.conf` с eMMC на Windows (в папку со скриптом)
3. Запусти `fix_sysctl.bat`
4. Скопируй исправленный `sysctl.conf` обратно на eMMC (замени оригинал)

### Вариант B: Вручную

1. Открой файл `E:\etc\sysctl.conf` (или другая буква диска) в блокноте
2. **СНАЧАЛА СДЕЛАЙ РЕЗЕРВНУЮ КОПИЮ!** Сохрани как `sysctl.conf.backup`
3. **КРИТИЧНО - удали в первую очередь эти строки (блокируют загрузку!):**

```
# Оптимизация для реального времени
kernel.sched_rt_runtime_us = 950000
kernel.sched_rt_period_us = 1000000
kernel.sched_migration_cost_ns = 5000000
```

4. **ВАЖНО - удали эти сетевые параметры:**

```
# Оптимизация для аудио пайплайна
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216
net.core.netdev_max_backlog = 5000
net.core.rmem_default = 262144
net.core.wmem_default = 262144
```

5. **ОПЦИОНАЛЬНО - можно оставить или удалить:**

```
vm.swappiness=1
vm.dirty_ratio=10
vm.dirty_background_ratio=5
```

6. Сохрани файл
7. **ВАЖНО:** Убедись, что файл сохранен правильно (проверь, что изменения применились)

## Шаг 3: Удалить проблемный сервис (КРИТИЧНО!)

**ВАЖНО:** Этот сервис может блокировать загрузку! Удали его обязательно.

1. Перейди в `E:\etc\systemd\system\` (или другая буква диска)
2. Найди файл `set-cpu-governor.service`
3. **Удали его полностью** (или переименуй в `set-cpu-governor.service.bak`)
4. **Проверь, что файл действительно удален!**

## Шаг 4: Проверить другие файлы (опционально)

Проверь эти файлы, если они есть:
- `E:\etc\security\limits.d\99-audio-pipeline.conf` - можно оставить
- `E:\etc\systemd\system\collect-metrics.service` - можно оставить
- `E:\etc\systemd\system\collect-metrics.timer` - можно оставить

## Шаг 5: Безопасно отключить eMMC

1. В Ext2Mgr нажми правой кнопкой на диск → "Change" → выбери "Unmount"
2. Или просто отключи USB адаптер

## Шаг 6: Вставить eMMC обратно

1. Выключи устройство (если включено)
2. Вставь eMMC обратно
3. Включи устройство
4. Должно загрузиться нормально

## Если не работает

1. Проверь, что файл `sysctl.conf` действительно исправлен (открой еще раз)
2. Проверь, что файл `set-cpu-governor.service` удален
3. Попробуй найти резервную копию `/etc/sysctl.conf.backup` и использовать ее

## Важно

- **Всегда делай резервные копии** перед изменением файлов
- **Не форматируй диск** - потеряешь все данные
- **Работай аккуратно** - проверяй каждый шаг

