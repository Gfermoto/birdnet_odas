# ЭКСТРЕННОЕ ВОССТАНОВЛЕНИЕ СЕТИ

## Проблема

После применения оптимизаций производительности устройство потеряло сетевое подключение.

## Причина

Сетевые параметры в `/etc/sysctl.conf` могли вызвать проблемы с работой сети.

## Решение

### Шаг 1: Физический доступ к устройству

Если есть физический доступ (монитор, клавиатура, или консоль):

```bash
# 1. Войти в систему
# 2. Скопировать скрипт восстановления (если есть USB или другой способ)
# Или выполнить команды вручную:

# Создать резервную копию
sudo cp /etc/sysctl.conf /etc/sysctl.conf.backup

# Удалить проблемные сетевые параметры
sudo sed -i '/# Оптимизация для аудио пайплайна/,/net.core.wmem_default = 262144/d' /etc/sysctl.conf

# Применить изменения
sudo sysctl -p

# Перезапустить сеть
sudo systemctl restart NetworkManager
# или
sudo systemctl restart systemd-networkd

# Проверить сетевые интерфейсы
ip addr show
ip link set eth0 up
sudo dhclient eth0
```

### Шаг 2: Альтернативные способы доступа

1. **Через консоль (если доступна):**
   - Serial console
   - HDMI + клавиатура
   - USB-to-Serial адаптер

2. **Через другой интерфейс:**
   - Wi-Fi (если был настроен)
   - Другой Ethernet порт (если есть)
   - ZeroTier VPN (если был настроен)

3. **Через роутер:**
   - Проверить, видит ли роутер устройство
   - Попробовать подключиться через другой IP (если DHCP выдал новый)

### Шаг 3: Ручное редактирование sysctl.conf

Если скрипт недоступен, отредактируйте файл вручную:

```bash
sudo nano /etc/sysctl.conf
```

Найдите и удалите или закомментируйте блок:
```
# Оптимизация для аудио пайплайна
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216
net.core.netdev_max_backlog = 5000
net.core.rmem_default = 262144
net.core.wmem_default = 262144
```

Сохраните файл (Ctrl+O, Enter, Ctrl+X) и выполните:
```bash
sudo sysctl -p
sudo systemctl restart NetworkManager
```

## После восстановления

1. **Проверить работу всех сервисов:**
```bash
systemctl status respeaker-loopback.service
systemctl status birdnet-go
systemctl status collect-metrics.timer
```

2. **Проверить логи:**
```bash
journalctl -xe | tail -50
dmesg | tail -50
```

3. **Обновить скрипт оптимизации:**
   - Сетевые параметры уже удалены из `optimize_performance.sh`
   - Больше не будут применяться автоматически

## Извинения

Приношу извинения за возникшую проблему. Сетевые параметры были удалены из скрипта оптимизации для предотвращения подобных проблем в будущем.

